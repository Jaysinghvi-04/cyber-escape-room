<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cyber Escape Room — Advanced Cyber Labs</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#071018; --panel:#0d161a; --text:#cfead6; --muted:#7b8a88;
      --accent:#4ef08a; --accent-2:#66b0ff; --error:#ff6b6b; --radius:12px;
      --mono:'Fira Code', monospace;
    }
    *{box-sizing:border-box} html,body{height:100%;}
    body{margin:0;background:linear-gradient(180deg,#071018 0%,#05060a 100%);
      color:var(--text);font-family:var(--mono);display:flex;align-items:center;justify-content:center;padding:28px;}
    .terminal{width:min(980px,96vw);background:rgba(255,255,255,0.02);border-radius:var(--radius);
      box-shadow:0 18px 50px rgba(2,8,15,0.7);border:1px solid rgba(255,255,255,0.04);overflow:hidden;}
    header{display:flex;align-items:center;gap:14px;padding:14px 18px;background:rgba(255,255,255,0.02);border-bottom:1px solid rgba(255,255,255,0.02)}
    .dot{width:12px;height:12px;border-radius:50%}
    .dot.red{background:#ff5f56}.dot.yellow{background:#ffbd2e}.dot.green{background:#27c93f}
    h1{font-size:15px;margin:0;color:var(--muted);letter-spacing:0.6px}
    .screen{padding:26px;display:flex;flex-direction:column;gap:16px}
    .welcome{text-align:center;padding:18px}
    .welcome h2{color:var(--accent);font-size:22px;margin:4px 0}
    .welcome p{color:var(--muted)}
    .story{color:var(--accent-2);font-size:14px;background:rgba(78,240,138,0.05);padding:10px;border-radius:8px}
    .question{font-size:18px;line-height:1.5;color:var(--text);}
    .controls{display:flex;gap:10px}
    input[type=text]{flex:1;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);
      padding:12px 14px;color:var(--text);border-radius:8px;}
    button{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#071018;
      padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600}
    .feedback{min-height:22px;font-size:14px}
    .ok{color:var(--accent);font-weight:700}
    .bad{color:var(--error);font-weight:700}
    .meta{color:var(--muted);font-size:13px}
    .center{text-align:center;padding:30px}
    .timer{
      position: fixed;
      right: 20px;
      top: 20px;
      background: rgba(255,255,255,0.05);
      padding: 12px 20px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--accent);
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      display: none;
    }
    .back-button {
      position: fixed;
      left: 20px;
      top: 20px;
      background: rgba(255,255,255,0.05);
      padding: 10px 20px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--accent-2);
      font-size: 14px;
      cursor: pointer;
      display: none;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      z-index: 100;
    }
    .back-button:hover {
      background: rgba(255,255,255,0.1);
      transform: translateY(-1px);
    }
  </style>
</head>
<body>
<div id="back-button" class="back-button">← Back</div>
<div id="timer" class="timer">00:00:00</div>
<div class="terminal">
  <header><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div><h1>Cyber Escape Room — Advanced Cyber Labs</h1></header>
  <main class="screen" id="app"></main>
</div>

<script>
(function(){
const answers = [
  "admin123", "SYN", "SSH", "SQL injection", "nmap -oG - | grep open",
  "DNS", "Proxy intercept tab", "MD5", "Password123!", "KHOOR",
  "Connection termination", "Application", "stegrocks", "root", "3306",
  "http", "nmap -A <target>", "admin", "64", "test", "True",
  "netstat -tuln", "WHERE", "packet loss", "steganography", "Atbash",
  "; ls", "SYN, SYN-ACK, ACK", "parameterized queries", "Wireshark"
];

const questions = [
{q:"You found a plaintext password in this page's source. What is it?",story:"Start simple — find the comment left by a lazy admin."},
{q:"Capture a TCP handshake in Wireshark. What is the first flag set in SYN packets?",story:"Students must recall TCP's initial flag used to start communication."},
{q:"During a scan, Nmap reports '22/tcp open'. Which service typically runs here?",story:"Identify default services from port numbers."},
{q:"BurpSuite intercepted request shows parameter: user=admin' OR 1=1 --. Which vulnerability is tested?",story:"Recognize common payload structures."},
{q:"Which command shows only open ports in Nmap output?",story:"Forces use of command-line filtering knowledge."},
{q:"Wireshark capture shows UDP packets on port 53. What protocol is this?",story:"Protocol identification from port number."},
{q:"In BurpSuite, where would you modify intercepted parameters?",story:"GUI-based recall under practical context."},
{q:"Hash: 5f4dcc3b5aa765d61d8327deb882cf99 — identify algorithm.",story:"Classic password hash recognition."},
{q:"Decode base64 string: UGFzc3dvcmQxMjMh",story:"Encourages manual decoding or online tool use."},
{q:"Encrypt 'HELLO' using Caesar cipher with shift 3.",story:"Hands-on substitution cipher."},
{q:"Wireshark shows packet marked [FIN, ACK]. What does this mean?",story:"Understanding of TCP flags."},
{q:"A server sends 'HTTP/1.1 404 Not Found'. What layer protocol is HTTP?",story:"OSI model identification."},
{q:"Steganography challenge: hidden message inside an image header reads 'key=stegrocks'. What is the key?",story:"Students must extract metadata using tools."},
{q:"You discover encoded credentials in a config file: dXNlcj1yb290O3Bhc3M9c3VwZXI=. Decode username.",story:"Base64 practical extraction."},
{q:"Find the default MySQL port number.",story:"Port/service association practice."},
{q:"In Wireshark, apply filter to show only HTTP packets.",story:"Using display filters correctly."},
{q:"Nmap aggressive scan syntax including OS detection?",story:"Testing scan option understanding."},
{q:"You intercepted cookie: session=eyJ1c2VyIjoiYWRtaW4ifQ==. Decode the username.",story:"Base64 session decode task."},
{q:"SHA256 hash length (in hex characters)?",story:"Recall fixed hash output sizes."},
{q:"Find plaintext password if MD5 hash matches '098f6bcd4621d373cade4e832627b4f6'.",story:"Reverse lookup via cracking or reasoning."},
{q:"BurpSuite Repeater lets you resend modified requests. True or False?",story:"Functional concept of Burp Repeater."},
{q:"Which command in Linux checks open network connections and listening ports?",story:"System command recall."},
{q:"In SQL, which clause restricts output to certain rows?",story:"Basic query comprehension."},
{q:"During capture, you see many TCP retransmissions. What network issue could cause this?",story:"Diagnosis reasoning."},
{q:"Find hidden text in image using 'strings' command. What type of technique is this?",story:"Concept classification."},
{q:"Ciphertext 'gsvjf rxpyi ldmul cqfnk hlevi gsvoz abwlt' — which cipher is used?",story:"Pattern recognition in monoalphabetic ciphers."},
{q:"Command injection payload to list files on Linux?",story:"Understand shell command chaining."},
{q:"Identify the three-way handshake order (write in short form).",story:"TCP connection initiation recall."},
{q:"SQL injection defense technique (short phrase).",story:"Security mitigation knowledge."},
{q:"Final Challenge: Which tool combines network sniffing, analysis, and protocol dissection?",story:"Synthesis — identify the ultimate packet tool."}
];

// Assign answers to questions
questions.forEach((q, i) => q.a = answers[i]);

const app = document.getElementById("app");
const timerElement = document.getElementById("timer");
const backButton = document.getElementById("back-button");
let idx = -1;
let startTime = null;
let timerInterval = null;

// Back button functionality
backButton.addEventListener('click', () => {
  if (idx > 0) {
    idx--;
    renderQ();
  } else if (idx === 0) {
    stopTimer();
    timerElement.style.display = 'none';
    backButton.style.display = 'none';
    renderWelcome();
  }
});

function updateTimer() {
  if (!startTime) return;
  const currentTime = new Date();
  const elapsedTime = new Date(currentTime - startTime);
  const hours = String(elapsedTime.getUTCHours()).padStart(2, '0');
  const minutes = String(elapsedTime.getUTCMinutes()).padStart(2, '0');
  const seconds = String(elapsedTime.getUTCSeconds()).padStart(2, '0');
  timerElement.textContent = `${hours}:${minutes}:${seconds}`;
}

function startTimer() {
  startTime = new Date();
  timerElement.style.display = 'block';
  timerInterval = setInterval(updateTimer, 1000);
}

function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function renderWelcome(){
  backButton.style.display = 'none';
  app.innerHTML=`<div class="welcome"><h2>Cyber Escape Room</h2><p>30 escalating cybersecurity puzzles. Some answers hide in source, others need decoding, scanning, or reasoning.</p><button>Start Lab</button></div>`;
  app.querySelector("button").onclick=()=>{
    idx=0;
    startTimer();
    renderQ();
  };
}

function renderQ(){
  backButton.style.display = 'flex';
  const x=questions[idx];
  app.innerHTML=`<div class='story'>${x.story}</div>
  <div class='question'>${x.q}</div>
  <div class='controls'><input type='text' placeholder='Type answer here' autocomplete='off'><button>Submit</button></div>
  <div class='feedback'></div><div class='meta'>Challenge ${idx+1} of ${questions.length}</div>`;
  const i=app.querySelector("input"),b=app.querySelector("button"),f=app.querySelector(".feedback");
  b.onclick=()=>check();
  i.onkeydown=e=>{if(e.key==="Enter"){e.preventDefault();check();}};

  function check(){
    if(i.value.trim().toLowerCase()===x.a.toLowerCase()){
      f.innerHTML=`
        <div style="padding: 10px; background: rgba(78,240,138,0.1); border-radius: 8px; margin: 10px 0;">
          <span class='ok'>✓ Excellent work!</span>
          <div style="margin-top: 5px; font-size: 14px;">
            Moving to the next challenge... Get ready!
          </div>
        </div>
      `;
      setTimeout(() => {
        idx++;
        if(idx >= questions.length) {
          done();
        } else {
          renderQ();
        }
      }, 1500);
    } else {
      f.innerHTML=`
        <div style="padding: 10px; background: rgba(255,107,107,0.1); border-radius: 8px; margin: 10px 0;">
          <span class='bad'>× Not quite right</span>
          <div style="margin-top: 5px; font-size: 14px;">
            Hint: Think about what the question is asking. Double-check your answer and try again!
          </div>
        </div>
      `;
    }
  }
}

function done(){
  const finalTime = timerElement.textContent;
  stopTimer();
  backButton.style.display = 'none';
  app.innerHTML=`
    <div class='center'>
      <h2>✅ Lab Complete!</h2>
      <p>Congratulations! You solved all ${questions.length} challenges.</p>
      <p style="color: var(--accent); margin: 20px 0;">Your completion time: ${finalTime}</p>
      <button onclick='idx=-1;timerElement.style.display="none";renderWelcome()'>Try Again</button>
    </div>
  `;
}

renderWelcome();
})();
</script>
</body>
</html>
